{"componentChunkName":"component---src-templates-blog-article-template-tsx","path":"/blog/2019/02/04/instrumentation-and-apollo-tracing","result":{"data":{"mdx":{"excerpt":"Today we have released Hot Chocolate  0.7.0 , containing one cool new feature,\nwe wanne talk about here, namely  Apollo Tracing  which isâ€¦","frontmatter":{"featuredImage":null,"path":"/blog/2019/02/04/instrumentation-and-apollo-tracing","title":"GraphQL .NET Instrumentation API and Apollo Tracing","tags":["hotchocolate","graphql","dotnet","aspnetcore","tracing"],"author":"Rafael Staib","authorImageUrl":"https://avatars0.githubusercontent.com/u/4325318?s=100&v=4","authorUrl":"https://github.com/rstaib","date":"February 04, 2019"},"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"path\": \"/blog/2019/02/04/instrumentation-and-apollo-tracing\",\n  \"date\": \"2019-02-04\",\n  \"title\": \"GraphQL .NET Instrumentation API and Apollo Tracing\",\n  \"tags\": [\"hotchocolate\", \"graphql\", \"dotnet\", \"aspnetcore\", \"tracing\"],\n  \"author\": \"Rafael Staib\",\n  \"authorUrl\": \"https://github.com/rstaib\",\n  \"authorImageUrl\": \"https://avatars0.githubusercontent.com/u/4325318?s=100&v=4\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Today we have released Hot Chocolate \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"0.7.0\"), \", containing one cool new feature,\\nwe wanne talk about here, namely \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Apollo Tracing\"), \" which is extremely powerful in\\nidentifing things like performance bottlenecks in our \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"GraphQL\"), \" \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"APIs\"), \" for\\nexample. As a result, we had to enhance our general instrumentation layer, which\\nwe all benefit from. For instance, now it's way easier to register a\\n\", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"DiagnosticObserver\"), \" and bring in your own tracing framework, respectively. In\\nthis blog article we will focus on these two topics.\"), mdx(\"h2\", {\n    \"id\": \"apollo-tracing\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#apollo-tracing\",\n    \"aria-label\": \"apollo tracing permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"viewBox\": \"0 0 512 512\",\n    \"width\": \"16\",\n    \"height\": \"16\"\n  }, \"\\n                        \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"d\": \"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z\"\n  }), \"\\n                      \")), \"Apollo Tracing\"), mdx(\"p\", null, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Apollo Tracing\"), \" is a \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/apollographql/apollo-tracing\"\n  }, \"performance tracing specification\"), \" for \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"GraphQL\"), \" servers.\\nIt's not part of the actual \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"GraphQL\"), \" \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://facebook.github.io/graphql\"\n  }, \"specification\"), \" itself, but there is a\\ncommon agreement in the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"GraphQL\"), \" community that this should be supported by\\nall \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"GraphQL\"), \" servers.\"), mdx(\"p\", null, \"So, we decided to introduce built-in \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Apollo Tracing\"), \" support with this version.\\nIn order to enable \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Apollo Tracing\"), \" we just need to provide our own instance of\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"QueryExecutionOptions\"), \" to the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"AddGraphQL\"), \" extension method and set the\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"TracingPreference\"), \" option to either \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"TracingPreference.Always\"), \" or\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"TracingPreference.OnDemand\"), \". The difference between these two options is\\nwhether tracing should be enabled always which means for each request or on\\ndemand which means per request. But for now, enough words, let's see how this\\nwould look like in code.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \"services.AddGraphQL(sp => Schema.Create(c =>\\n{\\n    // Here goes the schema definition which is omitted for brevity purpose\\n}),\\nnew QueryExecutionOptions\\n{\\n    TracingPreference = TracingPreference.Always\\n});\\n\")), mdx(\"p\", null, \"There it is. Very simple and straightforward, right? For more information head\\nover \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://hotchocolate.io/docs/apollo-tracing\"\n  }, \"here\"), \". Now, let's jump over to\\nthe next topic.\"), mdx(\"h2\", {\n    \"id\": \"instrumentation-api\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#instrumentation-api\",\n    \"aria-label\": \"instrumentation api permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"xmlns\": \"http://www.w3.org/2000/svg\",\n    \"viewBox\": \"0 0 512 512\",\n    \"width\": \"16\",\n    \"height\": \"16\"\n  }, \"\\n                        \", mdx(\"path\", {\n    parentName: \"svg\",\n    \"d\": \"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z\"\n  }), \"\\n                      \")), \"Instrumentation API\"), mdx(\"p\", null, \"In this version we did some heavy lifting in form of refactorings regarding the\\nquery execution pipeline. This really helped us enhancing the\\n\", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Instrumentation\"), \" \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"API\"), \" which has been evolved in two ways. First, we increased\\nthe amount of available diagnostic events for more fine-grained tracing\\nscenarios. Second, we simplified the registering of \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"DiagnosticObservers\"), \" by\\nusing \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Dependancy Injection\"), \" infrastructure. In the next example we can see how\\nto register a custom \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"DiagnosticObservers\"), \".\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \"services.AddGraphQL(sp => Schema.Create(c =>\\n{\\n    // Here goes the schema definition which is omitted for brevity purpose\\n}),\\nbuilder =>\\n{\\n    return builder\\n        .UseDefaultPipeline()\\n        .AddDiagnosticObserver<CustomDiagnosticObserver>();\\n});\\n\")), mdx(\"p\", null, \"So far so good. Writing a custom \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"DiagnosticObservers\"), \" is not difficult. Let's\\nsee how we could achieve this.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-csharp\"\n  }, \"using HotChocolate.Execution;\\nusing Microsoft.Extensions.DiagnosticAdapter;\\n\\nnamespace CustomNamespace\\n{\\n    internal class CustomDiagnosticObserver\\n        : IDiagnosticObserver\\n    {\\n        [DiagnosticName(\\\"HotChocolate.Execution.Query\\\")]\\n        public void QueryExecute()\\n        {\\n            // This method is required to enable recording \\\"Query.Start\\\" and\\n            // \\\"Query.Stop\\\" diagnostic events. Do not write code in here.\\n        }\\n\\n        [DiagnosticName(\\\"HotChocolate.Execution.Query.Start\\\")]\\n        public void BeginQueryExecute(IQueryContext context)\\n        {\\n            // Here goes your code to trace begin query execution events.\\n        }\\n\\n        [DiagnosticName(\\\"HotChocolate.Execution.Query.Stop\\\")]\\n        public void EndQueryExecute(\\n            IQueryContext context,\\n            IExecutionResult result)\\n        {\\n            // Here goes your code to trace end query execution events.\\n        }\\n    }\\n}\\n\")), mdx(\"p\", null, \"In the above example we showed you just a few diagnostic events. Head over\\n\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://hotchocolate.io/docs/instrumentation\"\n  }, \"here\"), \" for a complete list of\\ndiagnostic events.\"), mdx(\"p\", null, \"We hope you enjoyed reading and be welcome to let us know what you think about\\nit in the comments section. Thank you!\"));\n}\n;\nMDXContent.isMDXComponent = true;","fields":{"readingTime":{"text":"3 min read"}}},"site":{"siteMetadata":{"siteUrl":"https://chillicream.com","author":"Chilli_Cream"}}},"pageContext":{}},"staticQueryHashes":["2890364758","3416206942","4218812017"]}