{"componentChunkName":"component---src-templates-doc-page-template-tsx","path":"/docs/hotchocolate/v10/execution-engine/batching","result":{"data":{"file":{"childMdx":{"fields":{"slug":"/hotchocolate/v10/execution-engine/batching/"},"frontmatter":{"title":"Batching"},"body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Batching\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Hot Chocolate supports operation batching and request batching. But before we get into the details lets reflect on what batching is and what you can do with it.\"), mdx(\"p\", null, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://youtu.be/ViXL0YQnioU?t=626\"\n  }), mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"800px\"\n    }\n  }), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"53%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC3klEQVQoz6WSW0jUeRTHf9RDZRdK6UYXzC2HUstpSSLK7luQM5XWQ0oZ0c2NrIy2i82M/xnHGXVSNB1rdJppHMbRuTo5Vph2XzcieyhYNtiHhYpqo8J1Kwv89E+KoNe+8OGc8334cjgcsSOvlpJCHWZNEaYvmDUSZu03TFrZ00mUFukHMcqzXtLidNgwm0soMeqprjqFJEmIdWdb0f4eRuqOoOtuRfojQpFcdbKnvRVCeyNEYaefk50BNB0BjrY3U3wxQG19gCprFFO5nROSDX1pI263GzG3r40FvZdQvmlH+SrK3OcRUh6HSfo7yOw//SjuNzPrjoefbrpJ6GpkcvQcK7p87JeuolzewIGcfJTK7cTM0GC1nkGk9nWw6PUV0p5dJvWfdlIftZHyIELyvRBzugPMvhVEcS1I4sVmEoNuprgdrI4E2XksytKNYfao9rE0XcOwxEqcThci8a8w8x5eIKUnzM93wiTf8JNypYU5US+KsIcEWw3Ty0xMrzrNVGsDseW1LLF7KDBcZaaygJ3bDGSoDyOGJOFyeRHTuppQdDSjiDaRHvWT3upjZdDPLy0+Fro8zM/aRJZaRfy6TOKKbcQUWEgrc5Bv7CE2fgvaqk4WLNuKEIIGu7zhhEY7M1xOptrsTK6xkWR1ML/WSXJFAzNNNhJyDzBr/TbisvYxKq+CIdkGUo/Ucay6h7zf7nJQukz6qhwmTYwnGGpDjLNYmWaxMclYxwRdDbHHqxlbUMGY/RZG7yln5C4Lw3PLGJFdSkymAbFGgyK3kmcv3/DhXT+eYA/e0D16e3vp//BR3nS3gaF7zYjtxYhsPWKTDqHWINYWIlYcRyw+gkiTb6Q8JL+ETMKvjF+u47//3/NZ1fXXqXPe5qtEhsXL5kofmaVeNhqb2KD3sF7rRn2iEdXR86gOO1EddKDKP4daZm1ePbuKfPS97R8MePL0X148fzXYDwwMIPgBfQ74vv8EqQxEpLKhKHMAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Batching\",\n    \"title\": \"Batching\",\n    \"src\": \"/static/9cf35a10e12b3581d02e9a6d557874d1/7842b/batching.png\",\n    \"srcSet\": [\"/static/9cf35a10e12b3581d02e9a6d557874d1/f8f3a/batching.png 200w\", \"/static/9cf35a10e12b3581d02e9a6d557874d1/6a8a8/batching.png 400w\", \"/static/9cf35a10e12b3581d02e9a6d557874d1/7842b/batching.png 800w\", \"/static/9cf35a10e12b3581d02e9a6d557874d1/88569/batching.png 1108w\"],\n    \"sizes\": \"(max-width: 800px) 100vw, 800px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n    \"))), mdx(\"h1\", null, \"Introduction\"), mdx(\"p\", null, \"With batching we have added the capability run a sequence of operations. The batch is executed in order and the results of each request is yielded to the user once it has been computed. This means that we do not have to wait for the complete batch to be completed and can use the results as they are written to the response stream.\"), mdx(\"p\", null, \"This means that with batching we are able to delay expensive queries. Essentially, we can do something that we also can do with \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"@defer\"), \".\"), mdx(\"p\", null, \"Let's say we had a news site and wanted to fetch the stories and for each story the first two comments.\"), mdx(\"p\", null, \"We could do that with a single query like the following:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-graphql\"\n  }), \"query NewsFeed {\\n  stories {\\n    id @export(as: \\\"ids\\\")\\n    actor\\n    message\\n    comments(first: 2) {\\n      actor\\n      message\\n    }\\n  }\\n}\\n\")), mdx(\"p\", null, \"But in our case, we want the story content to be available really, really quickly and we do not mind if the comments appear a little later. So, what we could do here is to break this query into two and send them in as batch.\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"POST /graphql?batchOperations=[NewsFeed, StoryComments]\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-graphql\"\n  }), \"query NewsFeed {\\n  stories {\\n    id @export(as: \\\"ids\\\")\\n    actor\\n    message\\n  }\\n}\\n\\nquery StoryComments {\\n  stories(ids: $ids) {\\n    comments(first: 2) {\\n      actor\\n      message\\n    }\\n  }\\n}\\n\")), mdx(\"p\", null, \"The key to do this is our \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"@export\"), \" directive which is able to export results as variables for the next queries in the batch. Each query can add to the variables collection.\"), mdx(\"p\", null, \"Batching combined with \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"@export\"), \" becomes really interesting if you think about mutations. With this you can create a sequence of mutations that should run on your server and each result of a mutation can become a input for the next mutation in the chain. This allows you to efficiently write flows that run asynchronously on the server.\"), mdx(\"h1\", null, \"Operation Batching\"), mdx(\"p\", null, \"With operation batching you basically send in the same request as before. You can either opt to send plain GraphQL or send in the GraphQL-JSON-request.\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"More about the request structure can be read \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"/docs/hotchocolate/v10/server\"\n  }), \"here\"), \".\")), mdx(\"p\", null, \"Since we are sending in multiple operations, we specify the sequence with as a query parameter:\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"POST /graphql?batchOperations=[Operation1, Operation2, Operation3, Operation4]\")), mdx(\"p\", null, \"Currently we write the result as JSON-array into the HTTP-response-stream. Each result is written to the response stream as it appears so you could grab each element as it appears. If you want to change the serialization format you can implement \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"IResponseStreamSerializer\"), \" and register you custom serializer with the dependency injection.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-csharp\"\n  }), \"services.AddResponseStreamSerializer<CustomResponseStreamSerializer>();\\n\")), mdx(\"h1\", null, \"Request Batching\"), mdx(\"p\", null, \"Request batching is essentially a way to send in multiple GraphQL-JSON-requests. These requests are basically wrapped into a JSON-array and send in the same way as the standard GraphQL-JSON-request.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-json\"\n  }), \"[\\n    {\\n        # The query document.\\n        \\\"query\\\": \\\"query getHero { hero { name } }\\\",\\n\\n        # The name of the operation that shall be executed.\\n        \\\"operationName\\\": \\\"getHero\\\",\\n\\n        # A key under which a query document was saved on the server.\\n        \\\"id\\\": \\\"W5vrrAIypCbniaIYeroNnw==\\\",\\n\\n        # The variable values for this request.\\n        \\\"variables\\\": {\\n            \\\"a\\\": 1,\\n            \\\"b\\\": \\\"abc\\\"\\n        },\\n\\n        # Custom properties that can be passed to the execution engine context data.\\n        \\\"extensions\\\": {\\n            \\\"a\\\": 1,\\n            \\\"b\\\": \\\"abc\\\"\\n        }\\n    },\\n    {\\n        # The query document.\\n        \\\"query\\\": \\\"query getHero { hero { name } }\\\",\\n\\n        # The name of the operation that shall be executed.\\n        \\\"operationName\\\": \\\"getHero\\\",\\n\\n        # A key under which a query document was saved on the server.\\n        \\\"id\\\": \\\"W5vrrAIypCbniaIYeroNnw==\\\",\\n\\n        # The variable values for this request.\\n        \\\"variables\\\": {\\n            \\\"a\\\": 1,\\n            \\\"b\\\": \\\"abc\\\"\\n        },\\n\\n        # Custom properties that can be passed to the execution engine context data.\\n        \\\"extensions\\\": {\\n            \\\"a\\\": 1,\\n            \\\"b\\\": \\\"abc\\\"\\n        }\\n    },\\n]\\n\")), mdx(\"h1\", null, \"Export Directive\"), mdx(\"p\", null, \"The export directive allows to export the results of a query into a global variable pool from which each query in the sequence can pull data in.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-graphql\"\n  }), \"query NewsFeed {\\n  stories {\\n    id @export(as: \\\"ids\\\")\\n    actor\\n    message\\n  }\\n}\\n\\nquery StoryComments {\\n  stories(ids: $ids) {\\n    comments(first: 2) {\\n      actor\\n      message\\n    }\\n  }\\n}\\n\")), mdx(\"p\", null, \"In the above example we are exporting the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"id\"), \" field result into a variable \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"ids\"), \". Since we are exporting multiple ids the variable is essentially becoming a list. In our example we will get a list of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"System.String\"), \". As we collect the variables, we will hold them as the native .NET type and only coerce them once we have to create the variable inputs for the next operation.\"), mdx(\"p\", null, \"As can be seen in the above example we have not declared any variable for the next operation and are just using \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"$ids\"), \". While we still could declare the variable explicitly, we can infer the variable declaration. The query engine will essentially rewrite the query.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-graphql\"\n  }), \"query StoryComments($ids: [ID!]) {\\n  stories(ids: $ids) {\\n    comments(first: 2) {\\n      actor\\n      message\\n    }\\n  }\\n}\\n\")), mdx(\"p\", null, \"You can also export objects, so you are not limited to scalars.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-graphql\"\n  }), \"query NewsFeed {\\n  stories @export {\\n    id\\n    actor\\n    message\\n  }\\n}\\n\")), mdx(\"p\", null, \"In the above example we would export a list of story objects that would be coerced and converted to fit into an input object.\"), mdx(\"h1\", null, \"IBatchQueryExecutor\"), mdx(\"p\", null, \"If you want to write tests or implement your own batching middleware, then you just have to inject \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"IBatchQueryExecutor\"), \". The batch executor will return a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"IBatchQueryExecutionResult\"), \" which is essentially a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"IResponseStream\"), \".\"), mdx(\"p\", null, \"The response stream allows to read the results from the stream as they become available.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-csharp\"\n  }), \"while (!responseStream.IsCompleted)\\n{\\n    IReadOnlyQueryResult queryResult = await responseStream.ReadAsync();\\n    Console.WriteLine(query.ToJson());\\n}\\n\")));\n}\n;\nMDXContent.isMDXComponent = true;","tableOfContents":{"items":[{"url":"#introduction","title":"Introduction"},{"url":"#operation-batching","title":"Operation Batching"},{"url":"#request-batching","title":"Request Batching"},{"url":"#export-directive","title":"Export Directive"},{"url":"#ibatchqueryexecutor","title":"IBatchQueryExecutor"}]}}},"site":{"siteMetadata":{"siteUrl":"https://chillicream.com","repositoryUrl":"https://github.com/ChilliCream/hotchocolate","tools":{"slack":"http://bit.ly/joinchilli"}}},"config":{"products":[{"path":"hotchocolate","title":"Hot Chocolate","description":"Build your own thin GraphQL API layer on top of any resource.","versions":[{"path":"","title":"v11 (latest)","items":[{"path":"index","title":"Introduction","items":null},{"path":"get-started","title":"Get Started","items":null},{"path":"defining-a-schema","title":"Defining a schema","items":[{"path":"index","title":"Schema basics"},{"path":"versioning","title":"Versioning"},{"path":"unions-and-interfaces","title":"Unions and Interfaces"},{"path":"scalars","title":"Scalars"},{"path":"directives","title":"Directives"}]},{"path":"fetching-data","title":"Fetching data","items":[{"path":"index","title":"Resolver"},{"path":"fetching-from-databases","title":"Fetching from Databases"},{"path":"fetching-from-rest","title":"Fetching from REST"},{"path":"dataloader","title":"DataLoader"},{"path":"pagination","title":"Pagination"},{"path":"filtering","title":"Filtering"},{"path":"sorting","title":"Sorting"},{"path":"projections","title":"Projections"}]},{"path":"integrations","title":"Integrations","items":[{"path":"index","title":"Overview"},{"path":"entity-framework","title":"Entity Framework"},{"path":"spatial-data","title":"Spatial Data"}]},{"path":"performance","title":"Performance","items":[{"path":"index","title":"Overview"},{"path":"persisted-queries","title":"Persisted queries"},{"path":"automatic-persisted-queries","title":"Automatic persisted queries"}]},{"path":"api-reference","title":"API Reference","items":[{"path":"index","title":"Overview"},{"path":"object-type","title":"Object Type"},{"path":"language","title":"Language"},{"path":"extending-filtering","title":"Extending Filtering"},{"path":"visitors","title":"Visitors"},{"path":"aspnetcore","title":"ASP.NET Core"},{"path":"executable","title":"Executable"},{"path":"migrate-from-10-to-11","title":"Migrate from 10.5 to 11.0"}]}]},{"path":"v10","title":"v10 (previous)","items":[{"path":"index","title":"Introduction","items":null},{"path":"code-first","title":"Code-First","items":null},{"path":"schema-first","title":"Schema-First","items":null},{"path":"schema","title":"Schema","items":[{"path":"index","title":"Schema"},{"path":"object-type","title":"Object Type"},{"path":"interface-type","title":"Interface Type"},{"path":"union-type","title":"Union Type"},{"path":"input-object-type","title":"Input Object Type"},{"path":"enum-type","title":"Enum Type"},{"path":"descriptions","title":"Schema Descriptions"},{"path":"custom-scalar-types","title":"Scalar Type Support"},{"path":"descriptor-attributes","title":"Descriptor Attributes"},{"path":"extending-types","title":"Custom Base Classes"},{"path":"directives","title":"Directives"},{"path":"resolvers","title":"Resolvers"},{"path":"relay","title":"Relay"},{"path":"conventions","title":"Conventions"},{"path":"options","title":"Schema Options"}]},{"path":"data-fetching","title":"Data Fetching","items":[{"path":"index","title":"Data Loaders"},{"path":"pagination","title":"Pagination"},{"path":"filters","title":"Filters"}]},{"path":"security","title":"Security","items":[{"path":"index","title":"Authorization"},{"path":"security","title":"Security"}]},{"path":"execution-engine","title":"Execution Engine","items":[{"path":"index","title":"Middleware"},{"path":"validation-rules","title":"Validation Rules"},{"path":"instrumentation","title":"Instrumentation"},{"path":"apollo-tracing","title":"Apollo Tracing"},{"path":"batching","title":"Batching"},{"path":"persisted-queries","title":"Persisted Queries"},{"path":"custom-context-data","title":"Custom Context Data"},{"path":"subscriptions","title":"Subscriptions"},{"path":"type-conversion","title":"Type Conversion"},{"path":"error-filter","title":"Error Filter"},{"path":"execution-options","title":"Execution Options"}]},{"path":"server","title":"Server","items":[{"path":"index","title":"ASP.Net"},{"path":"dependency-injection","title":"Dependency Injection"}]},{"path":"stitching","title":"Schema Stitching","items":null},{"path":"tooling","title":"Tooling","items":null},{"path":"advanced","title":"Advanced","items":[{"path":"index","title":"Parser"},{"path":"dotnet-cli","title":".Net CLI"}]},{"path":"tutorials","title":"Tutorials","items":[{"path":"index","title":"Entity Framework"}]},{"path":"examples","title":"Examples","items":[{"path":"index","title":"Star Wars"},{"path":"slack-clone","title":"Slack Clone"},{"path":"other-examples","title":"Other Examples"}]}]}]},{"path":"bananacakepop","title":"Banana Cake Pop","description":"Use this GUI to get deep insights from any GraphQL API.","versions":[{"path":"","title":"v1 (preview)","items":[{"path":"index","title":"Introduction","items":null}]}]},{"path":"strawberryshake","title":"Strawberry Shake","description":"The only GraphQL client you will every need in the .NET ecosystem.","versions":[{"path":"","title":"v11 (latest)","items":[{"path":"index","title":"Introduction","items":null},{"path":"get-started","title":"Get Started","items":[{"path":"index","title":"Blazor"},{"path":"xamarin","title":"Xamarin"},{"path":"console","title":"Console"}]},{"path":"subscriptions","title":"Subscriptions","items":null},{"path":"caching","title":"Caching","items":[{"path":"index","title":"Overview"},{"path":"entities","title":"Entities"}]},{"path":"performance","title":"Performance","items":[{"path":"index","title":"Overview"},{"path":"persisted-state","title":"Persisted State"},{"path":"persisted-queries","title":"Persisted Queries"}]},{"path":"networking","title":"Networking","items":[{"path":"index","title":"Protocols"},{"path":"authentication","title":"Authentication"}]},{"path":"scalars","title":"Scalars","items":null}]}]},{"path":"greendonut","title":"Green Donut","description":"Configure data loaders and caching for GraphQL endpoints.","versions":[{"path":"","title":"v11 (latest)","items":[{"path":"index","title":"Introduction","items":null}]},{"path":"v10","title":"v10 (previous)","items":[{"path":"index","title":"Introduction","items":null},{"path":"installation","title":"Installation","items":null},{"path":"usage","title":"Usage","items":null},{"path":"api","title":"API","items":null},{"path":"advanced-concepts","title":"Advanced Concepts","items":[{"path":"index","title":"Custom DataLoader"},{"path":"diagnostics","title":"Diagnostic Events"}]}]}]}]}},"pageContext":{"originPath":"hotchocolate/v10/execution-engine/batching.md"}},"staticQueryHashes":["1014893094","2890364758","4218812017"]}